<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Crowchiper</title>
        <link rel="stylesheet" href="./css/app.css" />
        <link rel="stylesheet" href="./css/unlock.css" />
        <link rel="stylesheet" href="./css/settings-panel.css" />
    </head>
    <body>
        <div class="app-container">
            <aside id="sidebar" class="cl-sidebar">
                <div class="sidebar-header">
                    <h1>Crowchiper</h1>
                    <button
                        id="new-post-btn"
                        class="info cl-save-btn"
                        title="New post"
                    >
                        +
                    </button>
                </div>
                <nav
                    class="cl-post-list"
                    id="post-list"
                    aria-label="Posts"
                ></nav>
                <div class="sidebar-footer">
                    <div class="settings-dropdown">
                        <button
                            id="settings-btn"
                            class="cl-settings-btn"
                            type="button"
                            title="Settings"
                            aria-expanded="false"
                            aria-haspopup="true"
                        >
                            Settings
                        </button>
                        <div id="settings-menu" class="cl-settings-menu" hidden>
                            <div class="settings-menu-item" id="theme-setting">
                                <span class="settings-label">Theme</span>
                                <div id="theme-toggle"></div>
                            </div>
                            <button
                                class="settings-menu-item settings-menu-btn"
                                id="manage-sessions-btn"
                                type="button"
                            >
                                <span class="settings-label">
                                    Manage Sessions
                                </span>
                            </button>
                            <button
                                class="settings-menu-item settings-menu-btn"
                                id="logout-btn"
                                type="button"
                            >
                                <span class="settings-label">Logout</span>
                            </button>
                            <button
                                class="settings-menu-item settings-menu-btn settings-version-btn"
                                id="version-btn"
                                type="button"
                            >
                                <span class="settings-label" id="version-label">
                                    Version
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </aside>
            <button
                id="sidebar-toggle"
                class="ghost"
                type="button"
                aria-expanded="true"
                aria-controls="sidebar"
                aria-label="Toggle sidebar"
            >
                <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    aria-hidden="true"
                >
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>
            <main class="main-content">
                <header class="app-header">
                    <div class="header-actions">
                        <button
                            id="spellcheck-btn"
                            class="ghost cl-spellcheck-btn"
                            type="button"
                            data-enabled="false"
                            title="Toggle spellcheck"
                            aria-label="Toggle spellcheck"
                        >
                            <svg
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                aria-hidden="true"
                            >
                                <path
                                    d="M12.913 17H20.087M12.913 17L11 21M12.913 17L15.7783 11.009C16.0092 10.5263 16.1246 10.2849 16.2826 10.2086C16.4199 10.1423 16.5801 10.1423 16.7174 10.2086C16.8754 10.2849 16.9908 10.5263 17.2217 11.009L20.087 17M20.087 17L22 21M2 5H8M8 5H11.5M8 5V3M11.5 5H14M11.5 5C11.0039 7.95729 9.85259 10.6362 8.16555 12.8844M10 14C9.38747 13.7248 8.76265 13.3421 8.16555 12.8844M8.16555 12.8844C6.81302 11.8478 5.60276 10.4266 5 9M8.16555 12.8844C6.56086 15.0229 4.47143 16.7718 2 18"
                                ></path>
                            </svg>
                            <span>Abc</span>
                        </button>
                        <div
                            id="sync-indicator"
                            class="cl-sync-indicator"
                            data-status="idle"
                            data-testid="test-sync-indicator"
                        >
                            <svg
                                class="sync-icon sync-icon-check"
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                aria-hidden="true"
                            >
                                <path d="M20 6L9 17L4 12"></path>
                            </svg>
                            <svg
                                class="sync-icon sync-icon-spinner"
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                aria-hidden="true"
                            >
                                <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
                            </svg>
                            <svg
                                class="sync-icon sync-icon-error"
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                aria-hidden="true"
                            >
                                <path d="M18 6L6 18M6 6L18 18"></path>
                            </svg>
                            <div class="sync-particles" aria-hidden="true">
                                <span class="sync-particle"></span>
                                <span class="sync-particle"></span>
                                <span class="sync-particle"></span>
                                <span class="sync-particle"></span>
                                <span class="sync-particle"></span>
                                <span class="sync-particle"></span>
                            </div>
                        </div>
                        <button
                            id="delete-btn"
                            class="warning cl-save-btn"
                            disabled
                        >
                            Delete
                        </button>
                    </div>
                </header>
                <div class="editor-wrapper">
                    <div id="editor"></div>
                </div>
            </main>
        </div>
        <!-- Unlock overlay for encrypted content -->
        <div
            id="unlock-overlay"
            class="cl-unlock-overlay"
            hidden
            role="dialog"
            aria-modal="true"
            aria-labelledby="unlock-title"
            aria-describedby="unlock-description"
        >
            <div class="unlock-modal">
                <div class="unlock-icon" aria-hidden="true">
                    <svg
                        width="48"
                        height="48"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <rect
                            x="3"
                            y="11"
                            width="18"
                            height="11"
                            rx="2"
                            ry="2"
                        ></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                </div>
                <h2 id="unlock-title">Unlock your posts</h2>
                <p id="unlock-description">
                    Your posts are encrypted. Authenticate with your passkey to
                    decrypt them.
                </p>
                <button id="unlock-btn" class="btn-primary">
                    Unlock with Passkey
                </button>
                <div
                    id="unlock-error"
                    class="cl-unlock-error"
                    hidden
                    role="alert"
                ></div>
            </div>
        </div>

        <!-- HEIC conversion confirmation modal -->
        <div id="heic-overlay" class="heic-modal-overlay" hidden>
            <div class="heic-modal">
                <h3 class="heic-modal-title">HEIC Image Detected</h3>
                <p id="heic-message" class="heic-modal-message"></p>
                <div class="heic-modal-buttons">
                    <button
                        id="heic-cancel"
                        type="button"
                        class="heic-modal-btn heic-modal-btn-cancel"
                    >
                        Cancel
                    </button>
                    <button
                        id="heic-confirm"
                        type="button"
                        class="heic-modal-btn heic-modal-btn-confirm"
                    >
                        Convert
                    </button>
                </div>
            </div>
        </div>

        <!-- Hidden file input for image uploads -->
        <input
            type="file"
            id="image-upload-input"
            accept="image/*"
            multiple
            hidden
        />

        <!-- Settings panel overlay -->
        <div
            id="settings-panel"
            class="cl-settings-panel"
            hidden
            role="dialog"
            aria-modal="true"
            aria-labelledby="settings-panel-title"
        >
            <div class="settings-panel-content">
                <div class="settings-panel-header">
                    <h2 id="settings-panel-title">Settings</h2>
                    <button
                        id="settings-panel-close"
                        class="ghost settings-panel-close-btn"
                        type="button"
                        aria-label="Close settings"
                    >
                        <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            aria-hidden="true"
                        >
                            <path d="M18 6L6 18M6 6L18 18"></path>
                        </svg>
                    </button>
                </div>
                <div class="settings-panel-body">
                    <section class="settings-section">
                        <h3 class="settings-section-title">Active Sessions</h3>
                        <p class="settings-section-desc">
                            These are the devices currently logged into your
                            account. Revoke any session you don't recognize.
                        </p>
                        <div id="sessions-list" class="cl-sessions-list">
                            <div class="sessions-loading">
                                Loading sessions...
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- Version info modal -->
        <div
            id="version-modal"
            class="cl-version-modal-overlay"
            hidden
            role="dialog"
            aria-modal="true"
            aria-labelledby="version-modal-title"
        >
            <div class="cl-version-modal">
                <div class="version-modal-header">
                    <h3 id="version-modal-title">Version Information</h3>
                    <button
                        id="version-modal-close"
                        class="ghost version-modal-close-btn"
                        type="button"
                        aria-label="Close"
                    >
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            aria-hidden="true"
                        >
                            <path d="M18 6L6 18M6 6L18 18"></path>
                        </svg>
                    </button>
                </div>
                <div class="version-modal-body">
                    <div class="version-item">
                        <span class="version-item-label">Version</span>
                        <span class="version-item-value" id="version-value"
                            >Loading...</span
                        >
                    </div>
                    <div class="version-item">
                        <span class="version-item-label">Build</span>
                        <span class="version-item-value" id="build-value"
                            >Loading...</span
                        >
                    </div>
                </div>
            </div>
        </div>

        <!-- Success toast notification -->
        <div
            id="success-toast"
            class="cl-success-toast"
            hidden
            aria-live="polite"
        >
            <span id="success-toast-message"></span>
        </div>

        <!-- Error toast notification -->
        <div
            id="error-toast"
            class="cl-error-toast"
            hidden
            aria-live="assertive"
        >
            <span id="error-toast-message"></span>
            <button
                id="error-toast-close"
                class="cl-error-toast-close"
                aria-label="Dismiss"
            >
                &times;
            </button>
        </div>

        <script type="module" src="./src/main.ts"></script>
    </body>
</html>
